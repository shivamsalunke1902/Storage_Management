<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Farmer Storage Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #0f172a;
      color: #e2e8f0;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    header {
      background: #1e293b;
      width: 100%;
      padding: 20px;
      text-align: center;
      font-size: 1.5rem;
      font-weight: bold;
      color: #38bdf8;
      box-shadow: 0 2px 6px rgba(0,0,0,0.5);
    }
    .dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      width: 90%;
      max-width: 1000px;
      margin: 30px auto;
    }
    .card {
      background: #1e293b;
      padding: 20px;
      border-radius: 15px;
      text-align: center;
      box-shadow: 0 4px 10px rgba(0,0,0,0.4);
      transition: transform 0.2s ease;
    }
    .card:hover {
      transform: translateY(-5px);
    }
    .card h2 {
      margin-bottom: 10px;
      font-size: 1.2rem;
      color: #38bdf8;
    }
    .value {
      font-size: 2rem;
      font-weight: bold;
      margin-top: 10px;
    }
    .led-button {
      padding: 12px 25px;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      background: #38bdf8;
      color: #0f172a;
      font-weight: bold;
      transition: background 0.3s ease;
    }
    .led-button.off {
      background: #f87171;
      color: #fff;
    }
    footer {
      margin: 20px;
      font-size: 0.9rem;
      color: #94a3b8;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.1.0/mqttws31.min.js"></script>
</head>
<body>
  <header>üåæ Farmer Storage Monitoring Dashboard</header>

  <section class="dashboard">
    <div class="card">
      <h2>üå°Ô∏è Temperature</h2>
      <div class="value" id="temperature">-- ¬∞C</div>
    </div>
    <div class="card">
      <h2>üíß Humidity</h2>
      <div class="value" id="humidity">-- %</div>
    </div>
    <div class="card">
      <h2>üì¶ Preservation Days</h2>
      <div class="value" id="preservation">-- days</div>
    </div>
    <div class="card">
      <h2>üí° LED Control</h2>
      <button id="ledButton" class="led-button off" onclick="toggleLED()">Turn ON</button>
    </div>
  </section>

  <footer>Powered by ESP32 + DHT11 + MQTT | Agro Storage System</footer>

  <script>
    // ‚úÖ Replace with your MQTT broker
    const broker = "test.mosquitto.org";  
    const port = 8081; // Websocket port

    let clientID = "webClient-" + parseInt(Math.random() * 1000, 10);
    let client = new Paho.MQTT.Client(broker, port, clientID);

    client.onConnectionLost = function(response) {
      console.log("Connection lost: " + response.errorMessage);
    };

    client.onMessageArrived = function(message) {
      console.log("Message: " + message.destinationName + " - " + message.payloadString);

      if (message.destinationName === "esp32/dht/temp") {
        document.getElementById("temperature").textContent = message.payloadString + " ¬∞C";
      }
      if (message.destinationName === "esp32/dht/hum") {
        document.getElementById("humidity").textContent = message.payloadString + " %";
      }
      if (message.destinationName === "esp32/storage/days") {
        document.getElementById("preservation").textContent = message.payloadString + " days";
      }
      if (message.destinationName === "esp32/led/state") {
        updateLEDButton(message.payloadString);
      }
    };

    function connectMQTT() {
      client.connect({
        onSuccess: () => {
          console.log("Connected to broker");
          client.subscribe("esp32/dht/temp");
          client.subscribe("esp32/dht/hum");
          client.subscribe("esp32/storage/days");
          client.subscribe("esp32/led/state");
        },
        useSSL: true
      });
    }

    function toggleLED() {
      let btn = document.getElementById("ledButton");
      let newState = btn.classList.contains("off") ? "ON" : "OFF";
      let message = new Paho.MQTT.Message(newState);
      message.destinationName = "esp32/led";
      client.send(message);
    }

    function updateLEDButton(state) {
      let btn = document.getElementById("ledButton");
      if (state === "ON") {
        btn.textContent = "Turn OFF";
        btn.classList.remove("off");
      } else {
        btn.textContent = "Turn ON";
        btn.classList.add("off");
      }
    }

    connectMQTT();
  </script>
</body>
</html>
